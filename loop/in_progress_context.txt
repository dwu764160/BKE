DO NOT CHANGE â€” IN-PROGRESS CONTEXT (Machine-Readable Guidance)

Purpose:
- This file captures the full working context when a model or session encounters difficulty.
- It is intended to be written to by models that are failing on a task so other models can pick up
  where they left off. Do not manually edit this file unless you are coordinating the handoff.

Required Sections (use these headings exactly; other tools rely on them):
1) CONTEXT:
	- Brief summary of the task, current working directory, and any key files or inputs in use.
2) FAILURE_REASON:
	- Short, precise description of why the current attempt failed (errors, unexpected outputs).
3) ATTEMPTED_METHODS:
	- List the strategies, commands, and code changes that were tried (bullet list).
4) SOURCES_READ:
	- Links, files, docs, and commands consulted during troubleshooting.
5) NEXT_STEPS (explicit):
	- One-line actionable items the next agent should attempt, ordered by priority.

Formatting rules for automations:
- Keep each section label (e.g., CONTEXT:) on its own line, followed by content lines.
- Use plain text only â€” avoid embedding binary, images, or complex markup.
- Keep entries concise; prefer short bullet lists and single-line commands for reproducibility.

Example (template):
CONTEXT:
- Task: run `src/data_compute/audit_win_shares.py`
- Env: Linux, venv at `.venv/`, Python 3.10
- Key files: data/processed/player_profiles_advanced.parquet

FAILURE_REASON:
- ValueError: ambiguous DataFrame truth value raised at script exit check.

ATTEMPTED_METHODS:
- Added explicit None/empty check in `if __name__ == "__main__"` block.
- Re-ran script under venv; verified output.

SOURCES_READ:
- Local repo files: src/data_compute/audit_win_shares.py

NEXT_STEPS:
- If error recurs, inspect `load_data()` return value and file path accessibility.

DO NOT CHANGE this file format or the section headings; other automated agents rely on them.


---------------------------------------------CONTENTS STARTS HERE-----------------------------------------
CONTEXT:
- Task: Build Player Archetype Classification System
- Env: Linux, venv at `.venv/`, Python 3.10
- Key files: data/tracking/*/synergy_Offensive_*.parquet, data/tracking/*/tracking_*.parquet
- Status: ðŸ”„ IN PROGRESS - Creating archetype classification algorithm

PREVIOUS TASK COMPLETED (2025-02-05):
================================================================================
xRAPM Implementation & Data Fetching Fix
================================================================================
- Fixed data fetching: 100% player coverage achieved (1680 player-seasons)
- xRAPM validation results:
  * Overall: MAE 1.14, Correlation 0.564
  * Bigs: MAE 0.92, Corr 0.91 (excellent)
  * Guards: MAE 1.00, Corr 0.43 (good)
  * Wings: MAE 1.48, Corr 0.12 (needs investigation)
  * Superstars: MAE 1.09, Stars: MAE 1.25, Role Players: MAE 1.04

CURRENT TASK:
================================================================================
Phase 3b: Player Archetype Classification
================================================================================

ARCHETYPE DEFINITIONS (from user spec):
1. Ball Dominant Creator - High ISO/PnRBH/PostUp freq + high playmaking (AST, passes, secondary AST)
2. Interior Scorer - Low playmaking + high ball-dominant freq + high drives + low 3pt
3. Perimeter Scorer - Low playmaking + high ball-dominant freq + low drives + high 3pt
4. All-Around Scorer - Low playmaking + high ball-dominant freq + balanced drives/3pt
5. Ballhandler - High playmaking + ball dominant + lower scoring volume
6. Off-Ball Finisher - High Cut/PnRRm/Putback/Transition freq
7. Off-Ball Movement Shooter - High Handoff/Offscreen freq
8. Off-Ball Stationary Shooter - High SpotUp freq
9. Rotation Piece/Glue Guy - All-around, low usage rate

ADDITIONAL METRICS TO INCORPORATE:
- Four Factors: Shooting (40%), Turnovers (25%), Rebounding (20%), Free Throws (15%)
- Three-pointer impact: production, efficiency, wide-open, catch-and-shoot
- Driving impact: attempts, efficiency, FT rate
- Transition impact
- Playmaking: time of possession, average dribbles
- Screening impact

DATA SOURCES AVAILABLE:
- Synergy: ISO, PnRBH, PostUp, Cut, PnRRm, Handoff, OffScreen, SpotUp, Transition, OffRebound
- Tracking: Drives, Passing (AST, secondary AST, potential AST), Possessions (time, touches)
- Box Score: PTS, FG3A, FG3%, FTA, FT%, MIN, GP

NEXT_STEPS:
1. Create compute_player_archetypes.py with full classification algorithm
2. Validate archetype assignments against known player types
3. Investigate Wings/Stars poor xRAPM correlation
4. Integrate archetypes with xRAPM for prediction models

NEXT STEPS:
1. Mark "Stream A: Compute Linear Metrics" as complete in current_phase_plan
2. Proceed to RAPM implementation (next task in pipeline)
3. Consider adding more validation players for edge cases

UPDATE (2026-01-19):
- CONTEXT: Completed iterative BPM tuning and validation. Team-level NET_RTG handling added, AST big bonus retained, VERY_LOW_MIN_PENALTY increased.
- RESULTS: Full validation harness run; reported MAEs: WS 0.54, OWS 0.66, DWS 0.61, BPM 0.67, VORP 0.29 (PASS).
- RECENT FIXES: name-matching robustness for accented player names (e.g., JokiÄ‡); minutes-weighted `team_avg_net_rtg` computed from player on-court NET_RTG when team summary source is unreliable.
- ATTEMPTED_METHODS: refactor `compute_linear_metrics.py` to compute `team_avg_net_rtg`, add TEAM_NET_SCALE/IND_NET_SCALE params, increase VERY_LOW_MIN_PENALTY, add AST-based big bonus and guard playmaker follow-up notes.
- SOURCES_READ: reference/BPM_trends.txt (this repo), Basketball-Reference BPM & Win Shares docs (for formulas), local validation harness `tests/validate_advanced_metrics.py`.
- NEXT_STEPS (explicit):
  1) Implement RAPM/Adjusted Plus-Minus pipeline (`src/data_compute/compute_rapm.py`) using multi-season regularized regression and set as prior for downstream EPM/RAPM-based metrics. (High priority)
  2) Add targeted elite-guard playmaker bonus (Priority 2 in BPM_trends) and re-run validation to measure impact (medium priority).
  3) Add additional edge-case players to validation harness (GP2, Curry, Gafford, Mark Williams, Haliburton) and rerun to confirm stability (low priority).